# GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效
- <font color=#DC2D1E>**处理关键点：**</font>
    - <font color=#DC2D1E>**1.生成音频调用API：**</font> <font color=#FFAF38>**UGameplayStatics::PlaySoundAtLocation**</font> ； <font color=#DC2D1E>**生成音频绑定在目标身上API：**</font> <font color=#FFAF38>**UGameplayStatics::SpawnSoundAttached**</font> <font color=#DC2D1E>**此函数返回一个组件，可以使用**</font> <font color=#DC2D1E>`**.Stop();**`</font> <font color=#DC2D1E>**停止播放**</font>
    - <font color=#DC2D1E>**2.使用Niagara粒子系统需要引模块"**</font>
    - <font color=#DC2D1E>**3.生成Niagara粒子调用API：**</font> <font color=#FFAF38>**UNiagaraFunctionLibrary::SpawnSystemAtLocation**</font> ；
    - <font color=#DC2D1E>**4.重写Destoryed虚函数时，注意!!!要在调用父函数之前写逻辑!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!**</font>
- 视频链接
    - 【【AI中字】虚幻5C++教程使用GAS制作RPG游戏（一）-哔哩哔哩】 [https://b23.tv/met5M9E]("https://b23.tv/met5M9E")
- 使用Niagara粒子系统需要引模块" **Niagara** "
    -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-771830-320200.png)
- AAuraProjectile 中，创建Niagara粒子组件和音频组件。
    -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-842440-970317.png)
- 在抛射物组件中，当overlap重叠发生时 <font color=#FFAF38>**UGameplayStatics::PlaySoundAtLocation**</font> ； <font color=#FFAF38>**UNiagaraFunctionLibrary::SpawnSystemAtLocation**</font> ；然后判定是否为权威端，如果是权威端的话 <font color=#FFAF38>**destroy**</font>
    -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-202593-114076.png)
        -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-311057-716466.png)
- AAuraProjectile 中重写 <font color=#FFAF38>**Destroyed**</font> 虚函数。
    -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-363487-418403.png)
    -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-830318-775130.png)
        -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-574885-14214.png)
    - <font color=#DC2D1E>**3.重写Destoryed虚函数时，注意!!!要在调用父函数之前写逻辑!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!**</font>
- 在蓝图中，配置Niagara粒子系统和音频组件。
    -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-538271-958448.png) ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-257771-49378.png)
- 在火球发射时使用动画通知，播放音效，添加动画通知通道
    -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-855039-360867.png)
    -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-289995-106200.png)
- 小测试 ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-734655-609498.png)
    - 在抛射物 AAuraProjectile 中再添加一个循环声音组件。 <font color=#FFAF38>**Beginplay**</font> 时把它绑定在跟骨骼上。
        -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-654679-506125.png)
        -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-901138-592848.png)
    - 因为想删除的话，需要拿到这个函数的返回值是一个 audio component组件。
        -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-710101-353774.png)
        -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-142242-475547.png)
    - 当重叠发生时 Overlap的回调函数中需要停止这个循环声音组件
        -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-771144-179719.png)
            - <font color=#DC2D1E>**如果无法调用，需要引头文件**</font> ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-834248-694298.png)
        -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-254479-528231.png)
    - 蓝图中配置
        -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-219204-594636.png)
    - AAuraProjectile 中，为火球设置生命周期，防止无限存活占用内存，并在 <font color=#FFAF38>**Beginplay**</font> 时设置
        - 头文件
            -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-755150-728809.png)
        - 源文件
            -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-120834-338967.png)
- 此时，哥布林太矮了打不到，可以等出手位置低的时候攻击。。。 ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-503872-448627.png)
    -  ![图片](./GAS 6.4 当火球发生撞击时产生音效和Niagara粒子，火球飞行时加loop音效绑定到root,持有该音频组件，撞击后停止音效-幕布图片-4270-513484.png)