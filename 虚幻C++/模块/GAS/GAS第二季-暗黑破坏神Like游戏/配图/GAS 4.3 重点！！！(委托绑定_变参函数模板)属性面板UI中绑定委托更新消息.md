# GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息
- <font color=#DC2D1E>**处理关键点：**</font>
    - <font color=#DC2D1E>**1.属性菜单发送多播,单独属性的ItemWidgetUI接收，验证tag一致后更新自身信息（使用MachesTag验证）**</font>
    - <font color=#DC2D1E>**2.使用TMap把类型变量与静态函数的函数指针进行绑定**</font>
        - <font color=#DC2D1E>**函数指针格式：**</font>
        - <font color=#DC2D1E>**返回值类型（*指针名称）（参数类型）**</font>
    - <font color=#DC2D1E>**3.函数指针使用时格式：**</font>
        - <font color=#DC2D1E>**函数指针名（）；即可调用**</font>
    - <font color=#DC2D1E>**4.通过ASC组件获取 当属性变化时广播的委托变量/绑定Lambda回调**</font>
- UAttributeMenuWidgetController 中创建动态委托，创建在蓝图中需要配置DataAsset的变量
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-326934-181307.png)
- 情况说明：
    - 每当调用 HUD 的GetAttributeMenuWidgetController函数，就会触发 `BindCallbacksToDependencies()` 事件
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-278143-430450.png)
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-228642-648926.png)
    - 又因为在蓝图函数库 UAuraAbilitySystemLibrary 中的 静态 函数 `GetAttributeMenuWidgetController()` 调用了 HUD 的 `GetAttributeMenuWidgetController()` 函数
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-517127-447490.png)
    - 理论上是每次调用蓝图节点 `GetAttributeMenuWidgetController()` 函数获取 **AttributeMenuWidgetController** 时，触发 `BindCallbacksToDependencies()` 事件，但是因为 HUD 中只有当变量为nullptr时才会执行一次，所以相当于初始化的绑定
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-383296-73335.png)
        - 只执行一次 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-576325-44483.png)
- ***BP_AttributeMenuWidgetController*** 中配置DataAsset的变量
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-646645-946592.png)
- UAttributeMenuWidgetController 中  广播的函数加UFUNCTION( *BlueprintCallable* )
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-175968-620818.png)
- ***WBP_AttributeMenu*** 中 调用广播 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-240548-4441.png)
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-844862-757798.png)
- ***WBP_TextValueRow*** 中将需要用到的参数：文字/数值 提升为变量 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-512072-632122.png)
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-914795-783143.png)
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-701746-743681.png)
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-15394-693158.png)
    - 将文字提升为变量
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-751114-890677.png)
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-869011-245751.png)
- ***WBP_TextValueButtonRow*** 中绑定委托和回调，使用参数设置UI变量 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-99177-248380.png)
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-611187-668622.png)
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-428212-393550.png)
- 测试打印结果 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-770688-518017.png)
- ***WBP_TextValueRow*** 中加入GameplayTag变量 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-625980-555782.png)
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-309005-985314.png)
- ***WBP_AttributeMenu*** 中 给每个属性UI改名 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-243269-462086.png)
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-57686-970456.png) ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-47059-479512.png) ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-541964-477504.png)
    - 添加调用，修改逻辑 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-121289-670874.png)
- ***WBP_TextValueButtonRow*** 中 检查GameplayTag标签 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-330691-488186.png)
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-370118-67942.png)
- 测试打印结果 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-808403-168623.png)
- **四种方法！！！现在需要把类型变量与静态函数的函数指针进行绑定(委托绑定/变参函数模板)**
    - **乞丐版：** 不绑定直接复制粘贴，修改变量名字，加一堆， **复制粘贴** ，代码质量较低
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-983553-519555.png)
        - 太乞丐，我就不用了
    - **正常版：** 退而求其次， **类型变量与委托绑定**
        - **正常版：** 此时因为 UAttributeMenuWidgetController 中逻辑是这么写的，所以如果要绑定需要把所有的属性都搞一遍，太麻烦，此时搞一个 **正常版的技术思路** ，使用键值对，保存GameplayTag和委托，这样可以根据Tag，调用对应的事件 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-872726-546078.png)
            -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-729710-982370.png)
            -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-598558-918343.png)
            -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-17924-51324.png)
            - 运行测试 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-736500-717583.png)
            - **思路为** ：使用键值对TMap，保存GameplayTag和委托，这样可以将GameplayTag和委托事件绑定，根据Tag，调用对应的事件
    - **注意事项！！如果不用委托记得移除！！！！！！！**
        - **如果不用委托记得移除** ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-723193-662578.png)
    - **高级但纯纯炫技傻缺版：使用变参函数模板** **————但是可以改良** **嘎嘎高级版**
        - 原理
            -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-15291-471689.png)
                -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-843447-407103.png)
            -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-851330-865253.png)
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-742016-220113.png)
        - **构造中传的第一个参数tag不对！！！** ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-147584-325860.png)
        - 上图大意了 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-59462-153524.png)
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-439079-307190.png)
        - 测试结果 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-322550-254376.png)
        - **起别名，弥补傻缺感**
            -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-409675-932424.png)
        - 使用类模板， **嘎嘎高级版**
            -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-870651-229875.png)
            - 使用非常方便 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-342180-238231.png)
    - **高级版：使用函数指针**
        - 原理
            - 其实之前写了函数指针类型
                -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-365617-309358.png)
            - 演示 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-488539-157471.png)
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-883443-735016.png)
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-439456-254339.png)
        -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-652524-603541.png)
        - 测试结果 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-216418-291189.png)
- 加入TMap中加入主要属性和次要属性
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-821558-474912.png)
- 测试结果 ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-637920-698208.png)
- UAttributeMenuWidgetController 中，现在需要使用ASC的当属性变化广播绑定委托API，绑定所有属性回调使用lambda
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-450918-874362.png)
- UAttributeMenuWidgetController 中，将共有的功能抽象成单独的函数
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-532786-31759.png)
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-115538-822466.png)
- 测试用逻辑
    - **测试用逻辑：记得用完移除！！！** 我把火，ge进入时每秒+1抗性
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-410969-287981.png)
    -  ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-692185-754402.png)
- 测试结果gif ![图片](./GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息-幕布图片-983835-918802.gif)