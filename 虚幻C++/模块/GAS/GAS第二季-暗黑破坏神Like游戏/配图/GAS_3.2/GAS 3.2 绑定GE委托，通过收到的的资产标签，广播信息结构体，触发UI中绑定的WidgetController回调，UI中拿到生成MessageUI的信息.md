# GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息
- <font color=#DC2D1E>**处理关键点：**</font>
    - <font color=#DC2D1E>**1.使用ASC组件基类中，写好的委托 OnGameplayEffectAppliedDelegateToSelf（当应用GE到ASC时触发回调）**</font>
    - <font color=#DC2D1E>**2.一次性道具 配置资产标签AssetTag，这样可以在触发回调时通过FGameplayEffectSpec类的对象拿到FGameplayTagContainer（这个相当于水杯，tag相当于水）**</font>
    - <font color=#DC2D1E>**3.使用GEngine->AddOnScreenDebugMessage（相当于PrintString）发Message到视口**</font>
    - <font color=#DC2D1E>**4.先创建表格结构体（需要继承FTableRowBase！！！）在创建模板类，根据传入的表格查找指定行（FindRow，这里行命名实用了tag字符串的格式，便于查找）**</font>
    - <font color=#DC2D1E>**5.UPROPERTY(EditDefaultOnly)宏//在编辑器中显示并允许编辑这些属性的默认值，但不允许在实例级别进行修改。**</font>
    - <font color=#DC2D1E>**6.C++中创建Tag标签：FGameplayTag::RequestGameplayTag(FName("Message"))；并使用API（父类标签包含子类标签前提下） ：子类Tag.MatchesTag(父类Tag)检查子类标签中是否包含父类标签，若反过来检查则不生效，请注意！！！**</font>
- UAbilitySystemComponent中的多播位置
    -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-947244-743569.png)
    -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-644032-611869.png)
- UAuraAbilitySystemComponent 中创建 **绑定到多播的事件** 和 **多播回调**
    - 头文件
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-819264-39018.png)
    - 源文件
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-843744-803675.png)
- 何时调用 UAuraAbilitySystemComponent 中的 绑定到多播的事件： **AbilityActorInfoSet()** 呢？
    - AAuraCharacterBase 中创建虚函数 `**InitAbilityActorInfo()**`
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-318852-361763.png)
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-254323-105902.png)
    - AAuraCharacter 中重写虚函数 `**InitAbilityActorInfo()**`
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-833787-825036.png)
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-79016-770935.png)
    - AAuraEnemy 中重写虚函数 `**InitAbilityActorInfo()**`
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-905251-910791.png)
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-946149-841551.png)
- 此时拾取物品 会有通知 ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-650211-988030.png)
- 资产标签
    - UAuraAbilitySystemComponent中，回调时，打印接收到的 Tag
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-989108-702706.png)
    - 给 药水和水晶 加上资产标签
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-110496-156670.png)
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-310161-474769.png)
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-995305-808446.png)
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-584120-537870.png)
    - 测试打印Tag名字
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-185715-161684.png)
    - **资产标签不在 这里显示** ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-160865-66875.png)
- 当上面的属性变化时，想 广播发送给WidgetController(因为要根据Tag生成相应的小UI)
    - 在 UAuraAbilitySystemComponent 中创建广播，并在触发GE的回调时，广播收到的 `**FGameplayTagContainer**` 类型数据
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-379263-96167.png)
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-224020-759775.png)
    - UOverlayWidgetController 中绑定多播，回调使用Lambda表达式
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-680120-355758.png)
        - 若能触发，说明逻辑正常 ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-214225-830722.png)
- 创建一个结构体，收到Tag，发送Tag，UI中根据表格中的结构体查找相应信息，读取并调用UI
    - UOverlayWidgetController 中创建结构体
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-386037-488310.png)
    - UI中创建文件夹，存放UI相关的数据
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-247068-418737.png)
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-216674-492412.png)
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-798105-746811.png)
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-334260-372976.png)
    - 项目设置中 添加Tag
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-645309-792656.png)
    - UOverlayWidgetController 中创建智能指针 保存表格
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-728284-190623.png)
    - **BP_OverlayWidgetController** 中 配置表格
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-459436-32191.png)
    - 配置表格
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-715099-846876.png)
    - 修改GE中的资产标签
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-364497-467285.png) ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-358197-287879.png) ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-882147-718200.png) ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-236974-336495.png)
- UOverlayWidgetController 中创建一个模板函数，根据传入的表格和Tag，找到指定的行结构体并返回
    -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-682403-4212.png)
    -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-672234-584217.png)
- 在 UOverlayWidgetController 中创建动态多播，在获取到表格信息时广播到UI
    -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-619644-606956.png)
    -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-196999-401152.png)
- 小测试：在你觉得最合适的地方绑定多播，并在屏幕上打印 ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-21331-206961.png)
    - 自己尝试一下
        -  ![图片](./GAS 3.2 绑定GE委托，通过收到的的资产标签，广播信息结构体，触发UI中绑定的WidgetController回调，UI中拿到生成MessageUI的信息-幕布图片-225036-944810.png)